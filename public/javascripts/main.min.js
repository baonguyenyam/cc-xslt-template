"use strict";var editor,ModuleChoose="",App={note:"\nCác bước tạo file XSLT\n=====================\n\n1) Chọn Modules\n2) Thêm/bớt các attribute hoặc elements\n\nPhím tắt\n=====================\nCommand + Left: Di chuyển tới đầu dòng code\nCommand + Ctrl + Up: Di chuyển dòng code lên trên\nCommand + D: Chọn cùng giá trị",xslt_top:'<?xml version="1.0" encoding="utf-8"?>\n<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\n<xsl:output method="html" indent="yes"/>\n\n',xslt_bottom:"</xsl:stylesheet>",xslt_module_top:'\x3c!--Begin XXX--\x3e\n<xsl:template match="/">\n',xslt_module_top_section:'<section class="canhcam-YYY-1">\n<article class="list-items">\n',xslt_module_middle:'\x3c!--Call XXX Child--\x3e\n<xsl:apply-templates select="/XXXList/XXX"></xsl:apply-templates>',xslt_module_bottom:"\n</xsl:template>\n\n",xslt_module_bottom_section:"</article>\n</section>\n",xslt_module_top_child:'\x3c!--Begin XXX Child--\x3e\n<xsl:template match="XXX">\n',xslt_module_child_middle:'\x3c!--item--\x3e\n<div class="item">\n<xsl:attribute name="bg-img">\n<xsl:value-of select="ImageUrl"></xsl:value-of>\n</xsl:attribute>\n\x3c!--image--\x3e\n<img>\n<xsl:attribute name="src">\n<xsl:value-of select="ImageUrl"></xsl:value-of>\n</xsl:attribute>\n<xsl:attribute name="alt">\n<xsl:value-of select="Title" disable-output-escaping="yes"></xsl:value-of>\n</xsl:attribute>\n<xsl:attribute name="title">\n<xsl:value-of select="Title" disable-output-escaping="yes"></xsl:value-of>\n</xsl:attribute>\n</img>\n\x3c!--link--\x3e\n<xsl:if test="Url != \'\'">\n<a>\n<xsl:attribute name="href">\n<xsl:value-of select="Url"></xsl:value-of>\n</xsl:attribute>\n<xsl:value-of select="/XXXList/ViewMore"></xsl:value-of>\n</a>\n</xsl:if>\n</div>\n',xslt_module_bottom_child:"</xsl:template>\n\n",xslt_attr_top:'\x3c!--Attribute XXX--\x3e\n<xsl:attribute name="XXX">\n',xslt_attr_bottom:"\n</xsl:attribute>",xslt_alt:'<xsl:value-of select="Title" disable-output-escaping="yes"></xsl:value-of>',xslt_title:'<xsl:value-of select="Title"></xsl:value-of>',xslt_target:'<xsl:value-of select="Target"></xsl:value-of>',xslt_url:'<xsl:value-of select="Url"></xsl:value-of>',xslt_src:'<xsl:value-of select="ImageUrl"></xsl:value-of>',xslt_id:'<xsl:text>#item-</xsl:text>\n<xsl:value-of select="position()"></xsl:value-of>',xslt_class:"<xsl:text>classname</xsl:text>",xslt_class_active:"<xsl:text>classname active</xsl:text>"},substringMatcher=function(l){return function(t,e){new RegExp(t,"i");e(l)}},elements=["img","a","div","p","section","article","ul","li","hr"],attributes=["alt","src","title","class","class-active","href","target","id"],addnew=[];function __buildModule(t){var e,l;e='<xsl:if test="count(/'+t+"List/"+t+') > 0">\n'+App.xslt_module_top_section,l="\n"+App.xslt_module_bottom_section+"</xsl:if>";var n=App.xslt_top+App.xslt_module_top+e+App.xslt_module_middle+l+App.xslt_module_bottom+App.xslt_module_top_child+App.xslt_module_child_middle+App.xslt_module_bottom_child+App.xslt_bottom,s=new RegExp("XXX","g"),o=new RegExp("YYY","g");editor.setValue(n.replace(s,t).replace(o,t.toLowerCase())),editor.refresh(),inDents()}function __insertTemplateNewValue(t,e,l){var n=new RegExp("XXX","g");insertText((""===l?"\x3c!--Value of "+e+"--\x3e\n"+t:"\x3c!--"+l.replace(n,ModuleChoose)+"--\x3e\n"+t).replace(n,ModuleChoose)+"\n")}function __insertTemplateElms(t){var e=new RegExp("XXX","g");insertText(("\x3c!--Elements XXX--\x3e\n<"+t+"></"+t+">").replace(e,t))}function __insertTemplateAttr(t){var e="",l=new RegExp("XXX","g");"alt"===t?e=App.xslt_attr_top+App.xslt_alt+App.xslt_attr_bottom:"src"===t?e=App.xslt_attr_top+App.xslt_src+App.xslt_attr_bottom:"target"===t?e=App.xslt_attr_top+App.xslt_target+App.xslt_attr_bottom:"href"===t?e=App.xslt_attr_top+App.xslt_url+App.xslt_attr_bottom:"title"===t?e=App.xslt_attr_top+App.xslt_title+App.xslt_attr_bottom:"class"===t?e=App.xslt_attr_top+App.xslt_class+App.xslt_attr_bottom:"id"===t?e=App.xslt_attr_top+App.xslt_id+App.xslt_attr_bottom:"class-active"===t&&(e="<xsl:if test=\"IsActive='true'\">\n"+App.xslt_attr_top+App.xslt_class_active+App.xslt_attr_bottom+"\n</xsl:if>",t="class"),insertText(e.replace(l,t)+"\n")}function escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")}function insertText(t){var e=$(".CodeMirror")[0].CodeMirror.getDoc(),l=e.getCursor(),n=e.getLine(l.line),s={line:l.line,ch:l.ch};n.length,e.replaceRange(t,s),inDents()}function completeAfter(t,e){t.getCursor();return e&&!e()||setTimeout(function(){t.state.completionActive||t.showHint({completeSingle:!1})},100),CodeMirror.Pass}function completeIfAfterLt(e){return completeAfter(e,function(){var t=e.getCursor();return"<"==e.getRange(CodeMirror.Pos(t.line,t.ch-1),t)})}function completeIfInTag(e){return completeAfter(e,function(){var t=e.getTokenAt(e.getCursor());return!!("string"!=t.type||/['"]/.test(t.string.charAt(t.string.length-1))&&1!=t.string.length)&&CodeMirror.innerMode(e.getMode(),t.state).state.tagName})}function ___ReadyAdd(){$(".d-none").removeClass("d-none"),$(window).bind("beforeunload",function(){return"Bạn có muốn thoát trang ngay bây giờ?"})}function changeX(s){$(".dropdown-item").each(function(){var t=$(this).attr("old-data-set"),e=$(this).attr("data-set"),l=new RegExp("XXX","g"),n=new RegExp(t,"g");""===t?($(this).attr("old-data-set",s),$(this).attr("data-set",e.replace(l,s))):($(this).attr("old-data-set",s),$(this).attr("data-set",e.replace(n,s)))})}function inDents(){var e=$(".CodeMirror")[0].CodeMirror.getDoc();editor.operation(function(){for(var t=0;t<e.size;++t)editor.indentLine(t,"smart")})}$(document).ready(function(){$("#code").html(App.note),editor=CodeMirror.fromTextArea(document.getElementById("code"),{mode:"text/x-markdown",lineNumbers:!0,keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai",lineWrapping:!0,tabSize:4,indentUnit:4,smartIndent:!0,indentWithTabs:!0,styleActiveLine:!0,foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{Enter:"newLineAndIndent","'<'":completeAfter,"'/'":completeIfAfterLt,"' '":completeIfInTag,"'='":completeIfInTag,"Ctrl-Space":"autocomplete","Ctrl-Q":function(t){t.foldCode(t.getCursor())}},lint:!0,hintOptions:!0}),$("#modules").on("change",function(t){ModuleChoose=t.target.value,editor.setOption("mode","xml"),changeX(t.target.value),__buildModule(t.target.value),___ReadyAdd()}),$(".typeahead").typeahead({hint:!0,highlight:!0,minLength:0},{name:"addnew",source:substringMatcher(addnew)});var t=[];for(var e in attributes)if(attributes.hasOwnProperty(e)){var l='<option value="'+(s=attributes[e])+'"">'+s+"</option>";t.push(l)}$("#attrs").append(t),$("#attrs").select2({placeholder:"Vui lòng chọn",allowClear:!0}).on("select2:select",function(t){__insertTemplateAttr(t.target.value)});var n=[];for(var e in elements)if(elements.hasOwnProperty(e)){var s;l='<option value="'+(s=elements[e])+'"">'+s+"</option>";n.push(l)}$("#elms").append(n),$("#elms").select2({placeholder:"Vui lòng chọn",allowClear:!0}).on("select2:select",function(t){__insertTemplateElms(t.target.value)}),$(".dropdown").click(function(){var t=$(this).parents(".cnt"),e=escapeHtml($(t).find(".dropdown-item").attr("data-set"));$(t).find(".dropdown-item").html(e),$(t).find(".dropdown-menu").toggleClass("active")}),$(".dropdown-item").click(function(){$(this).parents(".dropdown-menu").toggleClass("active")})}),$(".dropdown-item").on("click",function(t){var e=$(this).attr("data-set"),l=$(this).attr("data-comment");__insertTemplateNewValue(e,$(this).parents(".cnt").find(".val").text(),l)}),$("#indent").on("click",function(t){t.preventDefault(),inDents()});