"use strict";var editor,ModuleChoose="",App={xslt_top:'<?xml version="1.0" encoding="utf-8"?>\n<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\n<xsl:output method="html" indent="yes"/>\n\n',xslt_bottom:"</xsl:stylesheet>",xslt_module_top:'\x3c!--Begin XXX--\x3e\n<xsl:template match="/">',xslt_module_middle:'\n\x3c!--Call XXX Child--\x3e\n<xsl:apply-templates select="/XXXList/XXX"></xsl:apply-templates>',xslt_module_bottom:"</xsl:template>\n",xslt_module_top_child:'\x3c!--Begin XXX Child--\x3e\n<xsl:template match="XXX">\n',xslt_module_bottom_child:"</xsl:template>\n\n",xslt_attr_top:'\x3c!--Attribute XXX--\x3e\n<xsl:attribute name="XXX">',xslt_attr_bottom:"</xsl:attribute>",xslt_alt:'<xsl:value-of select="Title" disable-output-escaping="yes"></xsl:value-of>',xslt_title:'<xsl:value-of select="Title"></xsl:value-of>',xslt_target:'<xsl:value-of select="Target"></xsl:value-of>',xslt_url:'<xsl:value-of select="Url"></xsl:value-of>',xslt_src:'<xsl:value-of select="ImageUrl"></xsl:value-of>'},substringMatcher=function(l){return function(t,e){new RegExp(t,"i");e(l)}},elements=["img","hr"],attributes=["alt","target","href","title","src"],addnew=[];function __buildModule(t){var e="",l="";"banner"===t.toLowerCase()&&(e='\n<xsl:if test="count(/BannerList/Banner) > 0">',l="\n</xsl:if>\n");var n=App.xslt_top+App.xslt_module_top+e+App.xslt_module_middle+l+App.xslt_module_bottom+App.xslt_module_top_child+App.xslt_module_bottom_child+App.xslt_bottom;editor.setValue(n.replace(/XXX/g,t)),editor.refresh(),inDents()}function __insertTemplateNewValue(t,e){insertText(("\x3c!--Value of "+e+"--\x3e\n"+t).replace(/XXX/g,ModuleChoose)+"\n")}function __insertTemplateElms(t){insertText(("\x3c!--Elements XXX--\x3e\n<"+t+"></"+t+">").replace(/XXX/g,t))}function __insertTemplateAttr(t){var e="";"alt"===t?e=App.xslt_attr_top+App.xslt_alt+App.xslt_attr_bottom:"src"===t?e=App.xslt_attr_top+App.xslt_src+App.xslt_attr_bottom:"target"===t?e=App.xslt_attr_top+App.xslt_target+App.xslt_attr_bottom:"href"===t?e=App.xslt_attr_top+App.xslt_url+App.xslt_attr_bottom:"title"===t&&(e=App.xslt_attr_top+App.xslt_title+App.xslt_attr_bottom),insertText(e.replace(/XXX/g,t)+"\n")}function escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")}function insertText(t){var e=$(".CodeMirror")[0].CodeMirror.getDoc(),l=e.getCursor(),n=e.getLine(l.line),o={line:l.line,ch:l.ch};n.length,e.replaceRange(t,o),inDents()}function completeAfter(t,e){t.getCursor();return e&&!e()||setTimeout(function(){t.state.completionActive||t.showHint({completeSingle:!1})},100),CodeMirror.Pass}function completeIfAfterLt(e){return completeAfter(e,function(){var t=e.getCursor();return"<"==e.getRange(CodeMirror.Pos(t.line,t.ch-1),t)})}function completeIfInTag(e){return completeAfter(e,function(){var t=e.getTokenAt(e.getCursor());return!!("string"!=t.type||/['"]/.test(t.string.charAt(t.string.length-1))&&1!=t.string.length)&&CodeMirror.innerMode(e.getMode(),t.state).state.tagName})}function ___ReadyAdd(){$(".d-none").removeClass("d-none"),$(window).bind("beforeunload",function(){return"Bạn có muốn thoát trang ngay bây giờ?"})}function inDents(){var e=$(".CodeMirror")[0].CodeMirror.getDoc();editor.operation(function(){for(var t=0;t<e.size;++t)editor.indentLine(t,"smart")})}$(document).ready(function(){editor=CodeMirror.fromTextArea(document.getElementById("code"),{mode:"xml",lineNumbers:!0,keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai",lineWrapping:!0,tabSize:4,indentUnit:4,smartIndent:!0,indentWithTabs:!0,foldGutter:!0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{Enter:"newLineAndIndent","'<'":completeAfter,"'/'":completeIfAfterLt,"' '":completeIfInTag,"'='":completeIfInTag,"Ctrl-Space":"autocomplete","Ctrl-Q":function(t){t.foldCode(t.getCursor())}},lint:!0}),$("#modules").on("change",function(t){ModuleChoose=t.target.value,__buildModule(t.target.value),___ReadyAdd()}),$(".typeahead").typeahead({hint:!0,highlight:!0,minLength:0},{name:"addnew",source:substringMatcher(addnew)});var t=[];for(var e in attributes)if(attributes.hasOwnProperty(e)){var l='<option value="'+(o=attributes[e])+'"">'+o+"</option>";t.push(l)}$("#attrs").append(t),$("#attrs").select2({placeholder:"Vui lòng chọn",allowClear:!0}).on("select2:select",function(t){__insertTemplateAttr(t.target.value)});var n=[];for(var e in elements)if(elements.hasOwnProperty(e)){var o;l='<option value="'+(o=elements[e])+'"">'+o+"</option>";n.push(l)}$("#elms").append(n),$("#elms").select2({placeholder:"Vui lòng chọn",allowClear:!0}).on("select2:select",function(t){__insertTemplateElms(t.target.value)}),$(".dropdown").click(function(){var t=$(this).parents(".cnt"),e=escapeHtml($(t).find(".dropdown-item").attr("data"));$(t).find(".dropdown-item").html(e),$(t).find(".dropdown-menu").toggleClass("active")}),$(".dropdown-item").click(function(){$(this).parents(".dropdown-menu").toggleClass("active")})}),$(".dropdown-item").on("click",function(t){__insertTemplateNewValue($(this).attr("data"),$(this).parents(".cnt").find(".val").text())}),$("#indent").on("click",function(t){t.preventDefault(),inDents()});